{
  "query": "\n-- Teams table\nCREATE TABLE IF NOT EXISTS teams (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  slug VARCHAR(100) NOT NULL UNIQUE,\n  description TEXT,\n  parentTeamId INT,\n  ownerId INT NOT NULL,\n  settings JSON,\n  logoUrl VARCHAR(500),\n  primaryColor VARCHAR(7) DEFAULT '#3B82F6',\n  maxMembers INT DEFAULT 10,\n  maxApplications INT DEFAULT 5,\n  maxClusters INT DEFAULT 3,\n  plan ENUM('free', 'starter', 'professional', 'enterprise') DEFAULT 'free' NOT NULL,\n  billingEmail VARCHAR(320),\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  suspendedAt TIMESTAMP NULL,\n  suspendedReason TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Team members table\nCREATE TABLE IF NOT EXISTS team_members (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT NOT NULL,\n  userId INT NOT NULL,\n  role ENUM('owner', 'admin', 'member', 'viewer') DEFAULT 'member' NOT NULL,\n  permissions JSON,\n  status ENUM('active', 'invited', 'suspended') DEFAULT 'active' NOT NULL,\n  invitedBy INT,\n  invitedAt TIMESTAMP NULL,\n  acceptedAt TIMESTAMP NULL,\n  lastActiveAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE KEY unique_team_user (teamId, userId)\n);\n\n-- Team invitations table\nCREATE TABLE IF NOT EXISTS team_invitations (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT NOT NULL,\n  email VARCHAR(320) NOT NULL,\n  role ENUM('admin', 'member', 'viewer') DEFAULT 'member' NOT NULL,\n  token VARCHAR(64) NOT NULL UNIQUE,\n  invitedBy INT NOT NULL,\n  personalMessage TEXT,\n  status ENUM('pending', 'accepted', 'declined', 'expired', 'cancelled') DEFAULT 'pending' NOT NULL,\n  expiresAt TIMESTAMP NOT NULL,\n  respondedAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Team resources table\nCREATE TABLE IF NOT EXISTS team_resources (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT NOT NULL,\n  resourceType ENUM('application', 'cluster', 'connection', 'autoscaling_rule', 'scheduled_scaling', 'ab_test', 'canary_deployment', 'prometheus_config', 'email_config') NOT NULL,\n  resourceId INT NOT NULL,\n  accessLevel ENUM('full', 'read_write', 'read_only') DEFAULT 'full' NOT NULL,\n  addedBy INT NOT NULL,\n  notes TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE KEY unique_team_resource (teamId, resourceType, resourceId)\n);\n\n-- Team activity table\nCREATE TABLE IF NOT EXISTS team_activity (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT NOT NULL,\n  userId INT,\n  activityType ENUM('member_joined', 'member_left', 'member_role_changed', 'resource_added', 'resource_removed', 'settings_changed', 'team_created', 'team_updated') NOT NULL,\n  description TEXT NOT NULL,\n  metadata JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_team_activity (teamId, createdAt)\n);\n\n-- Audit logs table\nCREATE TABLE IF NOT EXISTS audit_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT,\n  userEmail VARCHAR(320),\n  userName VARCHAR(255),\n  teamId INT,\n  action ENUM('login', 'logout', 'login_failed', 'password_changed', 'mfa_enabled', 'mfa_disabled', 'create', 'read', 'update', 'delete', 'deploy', 'rollback', 'scale', 'restart', 'stop', 'start', 'team_create', 'team_update', 'team_delete', 'member_invite', 'member_remove', 'member_role_change', 'config_change', 'secret_access', 'secret_update', 'ai_query', 'ai_recommendation_applied', 'export', 'import', 'admin_action', 'system_config_change') NOT NULL,\n  resourceType VARCHAR(100),\n  resourceId VARCHAR(255),\n  resourceName VARCHAR(255),\n  description TEXT NOT NULL,\n  previousState JSON,\n  newState JSON,\n  ipAddress VARCHAR(45),\n  userAgent VARCHAR(500),\n  requestId VARCHAR(64),\n  sessionId VARCHAR(64),\n  country VARCHAR(2),\n  city VARCHAR(100),\n  status ENUM('success', 'failure', 'partial') DEFAULT 'success' NOT NULL,\n  errorMessage TEXT,\n  riskLevel ENUM('low', 'medium', 'high', 'critical') DEFAULT 'low' NOT NULL,\n  isSuspicious BOOLEAN DEFAULT FALSE NOT NULL,\n  suspiciousReason TEXT,\n  duration INT,\n  metadata JSON,\n  tags JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_audit_user (userId, createdAt),\n  INDEX idx_audit_team (teamId, createdAt),\n  INDEX idx_audit_action (action, createdAt),\n  INDEX idx_audit_resource (resourceType, resourceId),\n  INDEX idx_audit_risk (riskLevel, isSuspicious)\n);\n\n-- Audit log policies table\nCREATE TABLE IF NOT EXISTS audit_log_policies (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  actionTypes JSON,\n  resourceTypes JSON,\n  riskLevels JSON,\n  retentionDays INT DEFAULT 90 NOT NULL,\n  archiveEnabled BOOLEAN DEFAULT FALSE NOT NULL,\n  archiveLocation VARCHAR(500),\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  lastAppliedAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Audit log alerts table\nCREATE TABLE IF NOT EXISTS audit_log_alerts (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  triggerConditions JSON NOT NULL,\n  notifyEmail BOOLEAN DEFAULT TRUE NOT NULL,\n  notifySlack BOOLEAN DEFAULT FALSE NOT NULL,\n  notifyWebhook BOOLEAN DEFAULT FALSE NOT NULL,\n  webhookUrl VARCHAR(500),\n  severity ENUM('info', 'warning', 'critical') DEFAULT 'warning' NOT NULL,\n  cooldownMinutes INT DEFAULT 15 NOT NULL,\n  lastTriggeredAt TIMESTAMP NULL,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  triggerCount INT DEFAULT 0 NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Audit log saved queries table\nCREATE TABLE IF NOT EXISTS audit_log_saved_queries (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  teamId INT,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  filters JSON NOT NULL,\n  columns JSON,\n  sortBy VARCHAR(100),\n  sortOrder ENUM('asc', 'desc') DEFAULT 'desc',\n  isShared BOOLEAN DEFAULT FALSE NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- User sessions table\nCREATE TABLE IF NOT EXISTS user_sessions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  sessionId VARCHAR(64) NOT NULL UNIQUE,\n  deviceType VARCHAR(50),\n  browser VARCHAR(100),\n  os VARCHAR(100),\n  ipAddress VARCHAR(45),\n  country VARCHAR(2),\n  city VARCHAR(100),\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  lastActivityAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  expiresAt TIMESTAMP NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_session_user (userId, isActive)\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 3FbHQcBqwdUAeZd.daf6bd01f5d9 --database bVoJhS4CeCN2GuJxoMncsM --execute \n-- Teams table\nCREATE TABLE IF NOT EXISTS teams (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  slug VARCHAR(100) NOT NULL UNIQUE,\n  description TEXT,\n  parentTeamId INT,\n  ownerId INT NOT NULL,\n  settings JSON,\n  logoUrl VARCHAR(500),\n  primaryColor VARCHAR(7) DEFAULT '#3B82F6',\n  maxMembers INT DEFAULT 10,\n  maxApplications INT DEFAULT 5,\n  maxClusters INT DEFAULT 3,\n  plan ENUM('free', 'starter', 'professional', 'enterprise') DEFAULT 'free' NOT NULL,\n  billingEmail VARCHAR(320),\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  suspendedAt TIMESTAMP NULL,\n  suspendedReason TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Team members table\nCREATE TABLE IF NOT EXISTS team_members (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT NOT NULL,\n  userId INT NOT NULL,\n  role ENUM('owner', 'admin', 'member', 'viewer') DEFAULT 'member' NOT NULL,\n  permissions JSON,\n  status ENUM('active', 'invited', 'suspended') DEFAULT 'active' NOT NULL,\n  invitedBy INT,\n  invitedAt TIMESTAMP NULL,\n  acceptedAt TIMESTAMP NULL,\n  lastActiveAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE KEY unique_team_user (teamId, userId)\n);\n\n-- Team invitations table\nCREATE TABLE IF NOT EXISTS team_invitations (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT NOT NULL,\n  email VARCHAR(320) NOT NULL,\n  role ENUM('admin', 'member', 'viewer') DEFAULT 'member' NOT NULL,\n  token VARCHAR(64) NOT NULL UNIQUE,\n  invitedBy INT NOT NULL,\n  personalMessage TEXT,\n  status ENUM('pending', 'accepted', 'declined', 'expired', 'cancelled') DEFAULT 'pending' NOT NULL,\n  expiresAt TIMESTAMP NOT NULL,\n  respondedAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Team resources table\nCREATE TABLE IF NOT EXISTS team_resources (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT NOT NULL,\n  resourceType ENUM('application', 'cluster', 'connection', 'autoscaling_rule', 'scheduled_scaling', 'ab_test', 'canary_deployment', 'prometheus_config', 'email_config') NOT NULL,\n  resourceId INT NOT NULL,\n  accessLevel ENUM('full', 'read_write', 'read_only') DEFAULT 'full' NOT NULL,\n  addedBy INT NOT NULL,\n  notes TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE KEY unique_team_resource (teamId, resourceType, resourceId)\n);\n\n-- Team activity table\nCREATE TABLE IF NOT EXISTS team_activity (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT NOT NULL,\n  userId INT,\n  activityType ENUM('member_joined', 'member_left', 'member_role_changed', 'resource_added', 'resource_removed', 'settings_changed', 'team_created', 'team_updated') NOT NULL,\n  description TEXT NOT NULL,\n  metadata JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_team_activity (teamId, createdAt)\n);\n\n-- Audit logs table\nCREATE TABLE IF NOT EXISTS audit_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT,\n  userEmail VARCHAR(320),\n  userName VARCHAR(255),\n  teamId INT,\n  action ENUM('login', 'logout', 'login_failed', 'password_changed', 'mfa_enabled', 'mfa_disabled', 'create', 'read', 'update', 'delete', 'deploy', 'rollback', 'scale', 'restart', 'stop', 'start', 'team_create', 'team_update', 'team_delete', 'member_invite', 'member_remove', 'member_role_change', 'config_change', 'secret_access', 'secret_update', 'ai_query', 'ai_recommendation_applied', 'export', 'import', 'admin_action', 'system_config_change') NOT NULL,\n  resourceType VARCHAR(100),\n  resourceId VARCHAR(255),\n  resourceName VARCHAR(255),\n  description TEXT NOT NULL,\n  previousState JSON,\n  newState JSON,\n  ipAddress VARCHAR(45),\n  userAgent VARCHAR(500),\n  requestId VARCHAR(64),\n  sessionId VARCHAR(64),\n  country VARCHAR(2),\n  city VARCHAR(100),\n  status ENUM('success', 'failure', 'partial') DEFAULT 'success' NOT NULL,\n  errorMessage TEXT,\n  riskLevel ENUM('low', 'medium', 'high', 'critical') DEFAULT 'low' NOT NULL,\n  isSuspicious BOOLEAN DEFAULT FALSE NOT NULL,\n  suspiciousReason TEXT,\n  duration INT,\n  metadata JSON,\n  tags JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_audit_user (userId, createdAt),\n  INDEX idx_audit_team (teamId, createdAt),\n  INDEX idx_audit_action (action, createdAt),\n  INDEX idx_audit_resource (resourceType, resourceId),\n  INDEX idx_audit_risk (riskLevel, isSuspicious)\n);\n\n-- Audit log policies table\nCREATE TABLE IF NOT EXISTS audit_log_policies (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  actionTypes JSON,\n  resourceTypes JSON,\n  riskLevels JSON,\n  retentionDays INT DEFAULT 90 NOT NULL,\n  archiveEnabled BOOLEAN DEFAULT FALSE NOT NULL,\n  archiveLocation VARCHAR(500),\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  lastAppliedAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Audit log alerts table\nCREATE TABLE IF NOT EXISTS audit_log_alerts (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  teamId INT,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  triggerConditions JSON NOT NULL,\n  notifyEmail BOOLEAN DEFAULT TRUE NOT NULL,\n  notifySlack BOOLEAN DEFAULT FALSE NOT NULL,\n  notifyWebhook BOOLEAN DEFAULT FALSE NOT NULL,\n  webhookUrl VARCHAR(500),\n  severity ENUM('info', 'warning', 'critical') DEFAULT 'warning' NOT NULL,\n  cooldownMinutes INT DEFAULT 15 NOT NULL,\n  lastTriggeredAt TIMESTAMP NULL,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  triggerCount INT DEFAULT 0 NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- Audit log saved queries table\nCREATE TABLE IF NOT EXISTS audit_log_saved_queries (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  teamId INT,\n  name VARCHAR(255) NOT NULL,\n  description TEXT,\n  filters JSON NOT NULL,\n  columns JSON,\n  sortBy VARCHAR(100),\n  sortOrder ENUM('asc', 'desc') DEFAULT 'desc',\n  isShared BOOLEAN DEFAULT FALSE NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- User sessions table\nCREATE TABLE IF NOT EXISTS user_sessions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  userId INT NOT NULL,\n  sessionId VARCHAR(64) NOT NULL UNIQUE,\n  deviceType VARCHAR(50),\n  browser VARCHAR(100),\n  os VARCHAR(100),\n  ipAddress VARCHAR(45),\n  country VARCHAR(2),\n  city VARCHAR(100),\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  lastActivityAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  expiresAt TIMESTAMP NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_session_user (userId, isActive)\n);\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 2028
}