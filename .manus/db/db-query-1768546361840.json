{
  "query": "CREATE TABLE IF NOT EXISTS `canary_deployments` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `applicationId` int,\n  `clusterId` int,\n  `name` varchar(255) NOT NULL,\n  `namespace` varchar(255) DEFAULT 'default',\n  `targetDeployment` varchar(255) NOT NULL,\n  `stableVersion` varchar(100),\n  `canaryVersion` varchar(100),\n  `stableImage` varchar(500),\n  `canaryImage` varchar(500),\n  `trafficSplitType` enum('percentage','header','cookie') DEFAULT 'percentage' NOT NULL,\n  `initialCanaryPercent` int DEFAULT 10 NOT NULL,\n  `currentCanaryPercent` int DEFAULT 0 NOT NULL,\n  `targetCanaryPercent` int DEFAULT 100 NOT NULL,\n  `incrementPercent` int DEFAULT 10 NOT NULL,\n  `incrementIntervalMinutes` int DEFAULT 5 NOT NULL,\n  `errorRateThreshold` int DEFAULT 5 NOT NULL,\n  `latencyThresholdMs` int DEFAULT 1000 NOT NULL,\n  `successRateThreshold` int DEFAULT 95 NOT NULL,\n  `minHealthyPods` int DEFAULT 1 NOT NULL,\n  `autoRollbackEnabled` boolean DEFAULT true NOT NULL,\n  `rollbackOnErrorRate` boolean DEFAULT true NOT NULL,\n  `rollbackOnLatency` boolean DEFAULT true NOT NULL,\n  `rollbackOnPodFailure` boolean DEFAULT true NOT NULL,\n  `maxRollbackAttempts` int DEFAULT 3 NOT NULL,\n  `analysisIntervalSeconds` int DEFAULT 30 NOT NULL,\n  `minAnalysisDuration` int DEFAULT 60 NOT NULL,\n  `requireManualApproval` boolean DEFAULT false NOT NULL,\n  `status` enum('pending','initializing','progressing','paused','promoting','promoted','rolling_back','rolled_back','failed','cancelled') DEFAULT 'pending' NOT NULL,\n  `statusMessage` text,\n  `startedAt` timestamp,\n  `lastProgressAt` timestamp,\n  `completedAt` timestamp,\n  `createdBy` varchar(255),\n  `gitCommit` varchar(100),\n  `gitBranch` varchar(255),\n  `pullRequestUrl` varchar(500),\n  `createdAt` timestamp NOT NULL DEFAULT (now()),\n  `updatedAt` timestamp NOT NULL DEFAULT (now()) ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `canary_deployments_id` PRIMARY KEY(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `canary_deployment_steps` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `deploymentId` int NOT NULL,\n  `stepNumber` int NOT NULL,\n  `targetPercent` int NOT NULL,\n  `status` enum('pending','running','completed','failed','skipped') DEFAULT 'pending' NOT NULL,\n  `requestCount` int DEFAULT 0,\n  `errorCount` int DEFAULT 0,\n  `avgLatencyMs` int,\n  `p99LatencyMs` int,\n  `successRate` int,\n  `healthyPods` int,\n  `totalPods` int,\n  `startedAt` timestamp,\n  `completedAt` timestamp,\n  `notes` text,\n  `createdAt` timestamp NOT NULL DEFAULT (now()),\n  CONSTRAINT `canary_deployment_steps_id` PRIMARY KEY(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `canary_metrics` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `deploymentId` int NOT NULL,\n  `stepId` int,\n  `canaryPercent` int NOT NULL,\n  `canaryRequests` int DEFAULT 0,\n  `stableRequests` int DEFAULT 0,\n  `canaryErrors` int DEFAULT 0,\n  `stableErrors` int DEFAULT 0,\n  `canaryErrorRate` int,\n  `stableErrorRate` int,\n  `canaryAvgLatency` int,\n  `stableAvgLatency` int,\n  `canaryP50Latency` int,\n  `stableP50Latency` int,\n  `canaryP95Latency` int,\n  `stableP95Latency` int,\n  `canaryP99Latency` int,\n  `stableP99Latency` int,\n  `canaryHealthyPods` int,\n  `canaryTotalPods` int,\n  `stableHealthyPods` int,\n  `stableTotalPods` int,\n  `canaryCpuPercent` int,\n  `stableCpuPercent` int,\n  `canaryMemoryPercent` int,\n  `stableMemoryPercent` int,\n  `analysisResult` enum('healthy','degraded','unhealthy','inconclusive') DEFAULT 'inconclusive',\n  `analysisNotes` text,\n  `timestamp` timestamp NOT NULL DEFAULT (now()),\n  CONSTRAINT `canary_metrics_id` PRIMARY KEY(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `canary_rollback_history` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `deploymentId` int NOT NULL,\n  `trigger` enum('auto_error_rate','auto_latency','auto_pod_failure','auto_health_check','manual','timeout','cancelled') NOT NULL,\n  `triggerValue` varchar(255),\n  `thresholdValue` varchar(255),\n  `canaryPercentAtRollback` int NOT NULL,\n  `stepAtRollback` int,\n  `status` enum('pending','in_progress','completed','failed') DEFAULT 'pending' NOT NULL,\n  `rollbackToVersion` varchar(100),\n  `rollbackToImage` varchar(500),\n  `initiatedAt` timestamp NOT NULL DEFAULT (now()),\n  `completedAt` timestamp,\n  `initiatedBy` varchar(255),\n  `reason` text,\n  `errorMessage` text,\n  `createdAt` timestamp NOT NULL DEFAULT (now()),\n  CONSTRAINT `canary_rollback_history_id` PRIMARY KEY(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `canary_templates` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `name` varchar(255) NOT NULL,\n  `description` text,\n  `trafficSplitType` enum('percentage','header','cookie') DEFAULT 'percentage' NOT NULL,\n  `initialCanaryPercent` int DEFAULT 10 NOT NULL,\n  `incrementPercent` int DEFAULT 10 NOT NULL,\n  `incrementIntervalMinutes` int DEFAULT 5 NOT NULL,\n  `errorRateThreshold` int DEFAULT 5 NOT NULL,\n  `latencyThresholdMs` int DEFAULT 1000 NOT NULL,\n  `successRateThreshold` int DEFAULT 95 NOT NULL,\n  `autoRollbackEnabled` boolean DEFAULT true NOT NULL,\n  `requireManualApproval` boolean DEFAULT false NOT NULL,\n  `isDefault` boolean DEFAULT false NOT NULL,\n  `createdAt` timestamp NOT NULL DEFAULT (now()),\n  `updatedAt` timestamp NOT NULL DEFAULT (now()) ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `canary_templates_id` PRIMARY KEY(`id`)\n);",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 3FbHQcBqwdUAeZd.daf6bd01f5d9 --database bVoJhS4CeCN2GuJxoMncsM --execute CREATE TABLE IF NOT EXISTS `canary_deployments` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `applicationId` int,\n  `clusterId` int,\n  `name` varchar(255) NOT NULL,\n  `namespace` varchar(255) DEFAULT 'default',\n  `targetDeployment` varchar(255) NOT NULL,\n  `stableVersion` varchar(100),\n  `canaryVersion` varchar(100),\n  `stableImage` varchar(500),\n  `canaryImage` varchar(500),\n  `trafficSplitType` enum('percentage','header','cookie') DEFAULT 'percentage' NOT NULL,\n  `initialCanaryPercent` int DEFAULT 10 NOT NULL,\n  `currentCanaryPercent` int DEFAULT 0 NOT NULL,\n  `targetCanaryPercent` int DEFAULT 100 NOT NULL,\n  `incrementPercent` int DEFAULT 10 NOT NULL,\n  `incrementIntervalMinutes` int DEFAULT 5 NOT NULL,\n  `errorRateThreshold` int DEFAULT 5 NOT NULL,\n  `latencyThresholdMs` int DEFAULT 1000 NOT NULL,\n  `successRateThreshold` int DEFAULT 95 NOT NULL,\n  `minHealthyPods` int DEFAULT 1 NOT NULL,\n  `autoRollbackEnabled` boolean DEFAULT true NOT NULL,\n  `rollbackOnErrorRate` boolean DEFAULT true NOT NULL,\n  `rollbackOnLatency` boolean DEFAULT true NOT NULL,\n  `rollbackOnPodFailure` boolean DEFAULT true NOT NULL,\n  `maxRollbackAttempts` int DEFAULT 3 NOT NULL,\n  `analysisIntervalSeconds` int DEFAULT 30 NOT NULL,\n  `minAnalysisDuration` int DEFAULT 60 NOT NULL,\n  `requireManualApproval` boolean DEFAULT false NOT NULL,\n  `status` enum('pending','initializing','progressing','paused','promoting','promoted','rolling_back','rolled_back','failed','cancelled') DEFAULT 'pending' NOT NULL,\n  `statusMessage` text,\n  `startedAt` timestamp,\n  `lastProgressAt` timestamp,\n  `completedAt` timestamp,\n  `createdBy` varchar(255),\n  `gitCommit` varchar(100),\n  `gitBranch` varchar(255),\n  `pullRequestUrl` varchar(500),\n  `createdAt` timestamp NOT NULL DEFAULT (now()),\n  `updatedAt` timestamp NOT NULL DEFAULT (now()) ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `canary_deployments_id` PRIMARY KEY(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `canary_deployment_steps` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `deploymentId` int NOT NULL,\n  `stepNumber` int NOT NULL,\n  `targetPercent` int NOT NULL,\n  `status` enum('pending','running','completed','failed','skipped') DEFAULT 'pending' NOT NULL,\n  `requestCount` int DEFAULT 0,\n  `errorCount` int DEFAULT 0,\n  `avgLatencyMs` int,\n  `p99LatencyMs` int,\n  `successRate` int,\n  `healthyPods` int,\n  `totalPods` int,\n  `startedAt` timestamp,\n  `completedAt` timestamp,\n  `notes` text,\n  `createdAt` timestamp NOT NULL DEFAULT (now()),\n  CONSTRAINT `canary_deployment_steps_id` PRIMARY KEY(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `canary_metrics` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `deploymentId` int NOT NULL,\n  `stepId` int,\n  `canaryPercent` int NOT NULL,\n  `canaryRequests` int DEFAULT 0,\n  `stableRequests` int DEFAULT 0,\n  `canaryErrors` int DEFAULT 0,\n  `stableErrors` int DEFAULT 0,\n  `canaryErrorRate` int,\n  `stableErrorRate` int,\n  `canaryAvgLatency` int,\n  `stableAvgLatency` int,\n  `canaryP50Latency` int,\n  `stableP50Latency` int,\n  `canaryP95Latency` int,\n  `stableP95Latency` int,\n  `canaryP99Latency` int,\n  `stableP99Latency` int,\n  `canaryHealthyPods` int,\n  `canaryTotalPods` int,\n  `stableHealthyPods` int,\n  `stableTotalPods` int,\n  `canaryCpuPercent` int,\n  `stableCpuPercent` int,\n  `canaryMemoryPercent` int,\n  `stableMemoryPercent` int,\n  `analysisResult` enum('healthy','degraded','unhealthy','inconclusive') DEFAULT 'inconclusive',\n  `analysisNotes` text,\n  `timestamp` timestamp NOT NULL DEFAULT (now()),\n  CONSTRAINT `canary_metrics_id` PRIMARY KEY(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `canary_rollback_history` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `deploymentId` int NOT NULL,\n  `trigger` enum('auto_error_rate','auto_latency','auto_pod_failure','auto_health_check','manual','timeout','cancelled') NOT NULL,\n  `triggerValue` varchar(255),\n  `thresholdValue` varchar(255),\n  `canaryPercentAtRollback` int NOT NULL,\n  `stepAtRollback` int,\n  `status` enum('pending','in_progress','completed','failed') DEFAULT 'pending' NOT NULL,\n  `rollbackToVersion` varchar(100),\n  `rollbackToImage` varchar(500),\n  `initiatedAt` timestamp NOT NULL DEFAULT (now()),\n  `completedAt` timestamp,\n  `initiatedBy` varchar(255),\n  `reason` text,\n  `errorMessage` text,\n  `createdAt` timestamp NOT NULL DEFAULT (now()),\n  CONSTRAINT `canary_rollback_history_id` PRIMARY KEY(`id`)\n);\n\nCREATE TABLE IF NOT EXISTS `canary_templates` (\n  `id` int AUTO_INCREMENT NOT NULL,\n  `userId` int NOT NULL,\n  `name` varchar(255) NOT NULL,\n  `description` text,\n  `trafficSplitType` enum('percentage','header','cookie') DEFAULT 'percentage' NOT NULL,\n  `initialCanaryPercent` int DEFAULT 10 NOT NULL,\n  `incrementPercent` int DEFAULT 10 NOT NULL,\n  `incrementIntervalMinutes` int DEFAULT 5 NOT NULL,\n  `errorRateThreshold` int DEFAULT 5 NOT NULL,\n  `latencyThresholdMs` int DEFAULT 1000 NOT NULL,\n  `successRateThreshold` int DEFAULT 95 NOT NULL,\n  `autoRollbackEnabled` boolean DEFAULT true NOT NULL,\n  `requireManualApproval` boolean DEFAULT false NOT NULL,\n  `isDefault` boolean DEFAULT false NOT NULL,\n  `createdAt` timestamp NOT NULL DEFAULT (now()),\n  `updatedAt` timestamp NOT NULL DEFAULT (now()) ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `canary_templates_id` PRIMARY KEY(`id`)\n);",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 828
}